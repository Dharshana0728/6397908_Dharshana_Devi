SET SERVEROUTPUT ON;

DECLARE
  CURSOR GenerateMonthlyStatements IS
    SELECT t.TransactionID, t.AccountID, t.TransactionDate, t.Amount, t.TransactionType, c.CustomerID, c.Name
    FROM Transactions t
    JOIN Accounts a ON t.AccountID = a.AccountID
    JOIN Customers c ON a.CustomerID = c.CustomerID
    WHERE TRUNC(t.TransactionDate, 'MM') = TRUNC(SYSDATE, 'MM');

  rec_trans GenerateMonthlyStatements%ROWTYPE;
BEGIN
  DBMS_OUTPUT.PUT_LINE('--- Monthly Statements for Current Month ---');

  OPEN GenerateMonthlyStatements;
  LOOP
    FETCH GenerateMonthlyStatements INTO rec_trans;
    EXIT WHEN GenerateMonthlyStatements%NOTFOUND;

    DBMS_OUTPUT.PUT_LINE(
      'Customer ' || rec_trans.CustomerID || ' (' || rec_trans.Name || '): ' ||
      'Transaction ' || rec_trans.TransactionID || ' on ' || TO_CHAR(rec_trans.TransactionDate, 'YYYY-MM-DD') ||
      ' - ' || rec_trans.TransactionType || ' of $' || rec_trans.Amount
    );
  END LOOP;
  CLOSE GenerateMonthlyStatements;
END;
/
